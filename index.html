<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Corte Bike Shop - Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="scripts/conf.js"></script>
  <style>
    body { padding-top: 70px; margin: 0; }
    .bg-parallax { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url("assets/bike3.jpg") no-repeat center center/cover; z-index: -1; }
    .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); z-index:-1; }
    .hero { min-height: 90vh; display:flex; align-items:center; font-family:'Montserrat', sans-serif; }
    .hero h2 { font-weight:400; font-size:1.5rem; color:#fff; text-shadow:1px 1px 5px rgba(0,0,0,0.7); }
    .hero h3 { color:#fff; text-shadow:1px 1px 5px rgba(0,0,0,0.7); }
    .hero h1 { font-weight:800; font-size:2.5rem; text-transform:uppercase; color:#fff; text-shadow:1px 1px 5px rgba(0,0,0,0.7); }
    .hero .highlight { background:#FFD600; color:#000; padding:0 8px; border-radius:4px; }
    .btn-primary { background-color:#FFD600; border:none; color:#000; font-weight:600; }
    .btn-primary:hover { background-color:#e6c200; }
    .login-card { background: rgba(255,255,255,0.55); border-radius:1rem; padding:2rem; }
    .footer { background:#fff; text-align:center; padding:2rem 1rem; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm border-bottom">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="assets/Picture.png" alt="Logo" width="100" height="40" class="me-2">
    </a>
  </div>
</nav>

<!-- Fondo -->
<div class="bg-parallax"></div>
<div class="overlay"></div>

<!-- Hero -->
<section class="hero">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6 mb-4 mb-md-0">
        <h2>游뛊 Vive la experiencia sobre dos ruedas</h2>
        <h3>Tu bicicleta, tu libertad</h3>
        <h1><span class="highlight">AGENDA TU CITA</span></h1>
        <h3>Mant칠n tu bici lista para la pr칩xima aventura</h3>
      </div>
      <div class="col-md-6 d-flex justify-content-center">
        <div class="login-card shadow-lg w-75">
          <h3 class="mb-4 text-center">Inicia Sesi칩n</h3>
          <form id="login-form">
            <div class="mb-3">
              <label for="emailLogin" class="form-label">Correo</label>
              <input type="email" class="form-control" id="emailLogin" placeholder="Ingresa tu correo" required>
            </div>
            <div class="mb-3">
              <label for="passwordLogin" class="form-label">Contrase침a</label>
              <input type="password" class="form-control" id="passwordLogin" placeholder="Ingresa tu contrase침a" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Entrar</button>
            <p class="mt-2 text-center">A칰n no est치s registrado? 
              <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Registro</a>
            </p>
          </form>
          <div id="mensajeLogin" class="mt-3 text-center text-danger"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<section class="footer">
  <h4>Sobre Nosotros</h4>
  <p>Somos apasionados de las bicicletas, ofreciendo servicio y calidad.</p>
  <h5>Horario de Atenci칩n</h5>
  <p>Lunes a Viernes: 9:00 - 18:00 <br> S치bado: 10:00 - 14:00</p>
</section>

<!-- Modal Registro -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="registerModalLabel">Registro de Usuario</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <form id="registro-form">
          <div class="mb-2">
            <label for="nombreRegister" class="form-label">Nombre completo</label>
            <input type="text" class="form-control" id="nombreRegister" name="nombre" required>
          </div>
          <div class="mb-2">
            <label for="emailRegister" class="form-label">Correo electr칩nico</label>
            <input type="email" class="form-control" id="emailRegister" name="email" required>
          </div>
          <div class="mb-2">
            <label for="passwordRegister" class="form-label">Contrase침a</label>
            <input type="password" class="form-control" id="passwordRegister" name="contrasena" required>
          </div>
          <div class="mb-2">
            <label for="passwordRegisterConf" class="form-label">Confirmar contrase침a</label>
            <input type="password" class="form-control" id="passwordRegisterConf" name="contrasena_conf" required>
          </div>
          <div class="mb-2">
            <label for="telefonoRegister" class="form-label">Tel칠fono</label>
            <input type="text" class="form-control" id="telefonoRegister" name="telefono" required>
          </div>
          <div class="mb-2">
            <label for="domicilioRegister" class="form-label">Domicilio</label>
            <input type="text" class="form-control" id="domicilioRegister" name="domicilio" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Registrar</button>
        </form>
        <div id="mensajeRegistro" class="mt-2 text-center text-danger"></div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Login
  document.getElementById("login-form").addEventListener("submit", function(event){
    event.preventDefault();
    const data = {
      email: document.getElementById("emailLogin").value,
      contrasena: document.getElementById("passwordLogin").value
    };
    fetch(`${CONFIG.API_URL}/api/usuarios/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    .then(async res => {
      if(!res.ok){
        const errorData = await res.json();
        throw new Error(errorData.msg || "Credenciales incorrectas");
      }
      return res.json();
    })
    .then(respuesta => {
      if(respuesta.access_token){
        localStorage.setItem("token", respuesta.access_token);
        const payload = JSON.parse(atob(respuesta.access_token.split('.')[1]));
        window.location.href = payload.rol === "admin" ? "dashboard.html" : "citas.html";
      } else {
        alert("Error: No se recibi칩 el token");
      }
    })
    .catch(error => { alert("Error en el login: " + error.message); });
  });

  // Registro
  document.getElementById("registro-form").addEventListener("submit", function(event){
    event.preventDefault();
    const contrasena = document.getElementById("passwordRegister").value;
    const contrasena_conf = document.getElementById("passwordRegisterConf").value;
    const mensajeDiv = document.getElementById("mensajeRegistro");

    if(contrasena !== contrasena_conf){
      mensajeDiv.textContent = "Las contrase침as no coinciden.";
      return;
    }
    mensajeDiv.textContent = "";

    const data = {
      nombre: document.getElementById("nombreRegister").value,
      email: document.getElementById("emailRegister").value,
      domicilio: document.getElementById("domicilioRegister").value,
      telefono: document.getElementById("telefonoRegister").value,
      contrasena: contrasena
    };

    fetch(`${CONFIG.API_URL}/api/usuarios/registro_cliente`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    .then(async res => {
      if(!res.ok){
        const errorData = await res.json();
        throw new Error(errorData.msg || "Error al registrar");
      }
      return res.json();
    })
    .then(respuesta => {
      alert("춰Registro exitoso! Ya puedes iniciar sesi칩n.");
      const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
      modal.hide();
      document.getElementById("registro-form").reset();
    })
    .catch(error => {
      mensajeDiv.textContent = error.message;
    });
  });
</script>

</body>
</html>
